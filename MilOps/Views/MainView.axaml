<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MilOps.ViewModels"
             xmlns:views="using:MilOps.Views"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="800"
             x:Class="MilOps.Views.MainView"
             x:DataType="vm:MainViewModel">
  <Design.DataContext>
    <vm:MainViewModel />
  </Design.DataContext>

  <Panel>
    <!-- 메인 컨텐츠 -->
    <Grid Background="#000000">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- 상단 헤더 -->
      <Border Grid.Row="0" Background="#333333" Padding="12">
        <Grid>
          <Button Command="{Binding ToggleDrawerCommand}"
                  Background="Transparent" BorderThickness="0"
                  HorizontalAlignment="Left" Padding="5,0">
            <TextBlock Text="☰" FontSize="22" Foreground="White"/>
          </Button>
          <TextBlock Text="{Binding CurrentPageTitle}"
                     FontSize="18"
                     Foreground="White"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"/>
        </Grid>
      </Border>

    <!-- 중앙 콘텐츠 영역 -->
    <Grid Grid.Row="1">
      <Border IsVisible="{Binding IsCalendarSelected}">
        <views:CalendarView/>
      </Border>
      <Border IsVisible="{Binding IsScheduleSelected}">
        <views:ScheduleListView x:Name="ScheduleListView"/>
      </Border>
      <Border IsVisible="{Binding IsManagerSelected}">
        <views:ManagerView/>
      </Border>
      <Border IsVisible="{Binding IsNotificationSelected}">
        <views:NotificationView x:Name="NotificationView"/>
      </Border>
      <Border IsVisible="{Binding IsSettingsSelected}">
        <views:SettingsView/>
      </Border>
    </Grid>

    <!-- 하단 네비게이션 바 -->
    <Border Grid.Row="2" Background="#333333" Padding="2">
      <Panel>
      <!-- 사용자용 메뉴: 캘린더 - 일정 - 알림 (3개) -->
      <Grid IsVisible="{Binding IsUser}">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 캘린더 -->
        <Button Grid.Column="0" Command="{Binding SelectTabCommand}" CommandParameter="calendar"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe935;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="캘린더" FontSize="12" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsCalendarSelected}"/>
              <TextBlock Text="캘린더" FontSize="12" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsCalendarSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 일정 -->
        <Button Grid.Column="1" Command="{Binding SelectTabCommand}" CommandParameter="schedule"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe0ee;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="일정" FontSize="12" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsScheduleSelected}"/>
              <TextBlock Text="일정" FontSize="12" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsScheduleSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 알림 -->
        <Button Grid.Column="2" Command="{Binding SelectTabCommand}" CommandParameter="notification"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe7f4;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="알림" FontSize="12" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsNotificationSelected}"/>
              <TextBlock Text="알림" FontSize="12" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsNotificationSelected}"/>
            </Panel>
          </StackPanel>
        </Button>
      </Grid>

      <!-- 중간관리자용 메뉴: 캘린더 - 일정 - 알림 - 담당자 (4개) -->
      <Grid IsVisible="{Binding IsMiddleAdmin}">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 캘린더 -->
        <Button Grid.Column="0" Command="{Binding SelectTabCommand}" CommandParameter="calendar"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe935;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="캘린더" FontSize="11" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsCalendarSelected}"/>
              <TextBlock Text="캘린더" FontSize="11" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsCalendarSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 일정 -->
        <Button Grid.Column="1" Command="{Binding SelectTabCommand}" CommandParameter="schedule"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe0ee;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="일정" FontSize="11" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsScheduleSelected}"/>
              <TextBlock Text="일정" FontSize="11" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsScheduleSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 알림 -->
        <Button Grid.Column="2" Command="{Binding SelectTabCommand}" CommandParameter="notification"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe7f4;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="알림" FontSize="11" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsNotificationSelected}"/>
              <TextBlock Text="알림" FontSize="11" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsNotificationSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 담당자 -->
        <Button Grid.Column="3" Command="{Binding SelectTabCommand}" CommandParameter="manager"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe7ef;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="담당자" FontSize="11" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsManagerSelected}"/>
              <TextBlock Text="담당자" FontSize="11" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsManagerSelected}"/>
            </Panel>
          </StackPanel>
        </Button>
      </Grid>

      <!-- 최종관리자용 메뉴: 캘린더 - 알림 - 담당자관리 (3개) -->
      <Grid IsVisible="{Binding IsSuperAdmin}">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 캘린더 -->
        <Button Grid.Column="0" Command="{Binding SelectTabCommand}" CommandParameter="calendar"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe935;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="캘린더" FontSize="12" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsCalendarSelected}"/>
              <TextBlock Text="캘린더" FontSize="12" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsCalendarSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 알림 -->
        <Button Grid.Column="1" Command="{Binding SelectTabCommand}" CommandParameter="notification"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe7f4;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="알림" FontSize="12" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsNotificationSelected}"/>
              <TextBlock Text="알림" FontSize="12" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsNotificationSelected}"/>
            </Panel>
          </StackPanel>
        </Button>

        <!-- 담당자 -->
        <Button Grid.Column="2" Command="{Binding SelectTabCommand}" CommandParameter="manager"
                Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Padding="2,0">
          <StackPanel HorizontalAlignment="Center" Spacing="0">
            <TextBlock Text="&#xe7ef;" FontFamily="{StaticResource MaterialIcons}" FontSize="20" HorizontalAlignment="Center"/>
            <Panel>
              <TextBlock Text="관리" FontSize="12" HorizontalAlignment="Center" Foreground="#00FF00"
                         IsVisible="{Binding IsManagerSelected}"/>
              <TextBlock Text="관리" FontSize="12" HorizontalAlignment="Center" Foreground="White"
                         IsVisible="{Binding !IsManagerSelected}"/>
            </Panel>
          </StackPanel>
        </Button>
      </Grid>
      </Panel>
    </Border>
    </Grid>

    <!-- 드로어 오버레이 (반투명 배경) -->
    <Border x:Name="DrawerOverlay"
            Background="#000000"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            IsVisible="False"
            Opacity="0"
            PointerPressed="OnOverlayPressed"/>

    <!-- 사이드 드로어 -->
    <Border x:Name="DrawerPanel"
            Background="#222222"
            Width="280"
            HorizontalAlignment="Left"
            IsVisible="False">
      <Border.RenderTransform>
        <TranslateTransform X="-280"/>
      </Border.RenderTransform>
      <Grid RowDefinitions="Auto,*,Auto">
        <!-- 드로어 헤더 - 사용자 정보 -->
        <Border Grid.Row="0" Background="#333333" Padding="20">
          <StackPanel Spacing="12">
            <TextBlock Text="내 정보" FontSize="20" Foreground="White" FontFamily="Malgun Gothic, Microsoft YaHei, sans-serif"/>

            <!-- 이름 -->
            <StackPanel Spacing="2">
              <TextBlock Text="이름" FontSize="12" Foreground="#888888"/>
              <TextBlock Text="{Binding CurrentUserName}" FontSize="16" Foreground="White" FontFamily="Malgun Gothic, Microsoft YaHei, sans-serif"/>
            </StackPanel>

            <!-- 직책/계급 -->
            <StackPanel Spacing="2" IsVisible="{Binding CurrentUserPosition, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
              <TextBlock Text="직책" FontSize="12" Foreground="#888888"/>
              <TextBlock Text="{Binding CurrentUserPosition}" FontSize="14" Foreground="White" FontFamily="Malgun Gothic, Microsoft YaHei, sans-serif"/>
            </StackPanel>

            <!-- 역할 -->
            <StackPanel Spacing="2">
              <TextBlock Text="역할" FontSize="12" Foreground="#888888"/>
              <TextBlock Text="{Binding CurrentUserRole}" FontSize="14" Foreground="#00FF00" FontFamily="Malgun Gothic, Microsoft YaHei, sans-serif"/>
            </StackPanel>

            <!-- 소속/지역 -->
            <StackPanel Spacing="2" IsVisible="{Binding CurrentUserRegion, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
              <TextBlock Text="소속" FontSize="12" Foreground="#888888"/>
              <TextBlock Text="{Binding CurrentUserRegion}" FontSize="14" Foreground="White" FontFamily="Malgun Gothic, Microsoft YaHei, sans-serif" TextWrapping="Wrap"/>
            </StackPanel>

            <!-- 아이디 -->
            <StackPanel Spacing="2">
              <TextBlock Text="아이디" FontSize="12" Foreground="#888888"/>
              <TextBlock Text="{Binding CurrentUserId}" FontSize="14" Foreground="#AAAAAA"/>
            </StackPanel>

            <!-- 연락처 -->
            <StackPanel Spacing="2" IsVisible="{Binding CurrentUserPhone, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
              <TextBlock Text="연락처" FontSize="12" Foreground="#888888"/>
              <TextBlock Text="{Binding CurrentUserPhone}" FontSize="14" Foreground="White"/>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- 빈 공간 -->
        <Grid Grid.Row="1"/>

        <!-- 로그아웃 버튼 -->
        <Border Grid.Row="2" Padding="20">
          <Button Command="{Binding LogoutCommand}"
                  Background="#AA0000"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Padding="15">
            <TextBlock Text="로그아웃" FontSize="16" Foreground="White"/>
          </Button>
        </Border>
      </Grid>
    </Border>

    <!-- 업체 등록 화면 오버레이 -->
    <Border Background="#000000"
            IsVisible="{Binding IsCompanyRegisterOpen}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      <views:CompanyRegisterView x:Name="CompanyRegisterView"/>
    </Border>

    <!-- 일정 생성 화면 오버레이 -->
    <Border Background="#000000"
            IsVisible="{Binding IsScheduleCreateOpen}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      <views:ScheduleCreateView x:Name="ScheduleCreateView"/>
    </Border>

    <!-- 일정 입력 화면 오버레이 (지자체담당자용) -->
    <Border Background="#000000"
            IsVisible="{Binding IsScheduleInputOpen}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      <views:ScheduleInputView x:Name="ScheduleInputView"/>
    </Border>

    <!-- 일정 예약 화면 오버레이 (대대담당자용) -->
    <Border Background="#000000"
            IsVisible="{Binding IsScheduleReserveOpen}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      <views:ScheduleReserveView x:Name="ScheduleReserveView"/>
    </Border>

    <!-- 일정 확정 화면 오버레이 (양측 공통) -->
    <Border Background="#000000"
            IsVisible="{Binding IsScheduleConfirmOpen}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      <views:ScheduleConfirmView x:Name="ScheduleConfirmView"/>
    </Border>
  </Panel>
</UserControl>
