<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MilOps.ViewModels"
             x:Class="MilOps.Views.ScheduleListView"
             x:DataType="vm:ScheduleListViewModel">

  <Grid Background="#000000">
    <ScrollViewer HorizontalScrollBarVisibility="Disabled">
      <StackPanel Margin="10" Spacing="10">

        <!-- íŽ˜ì´ì§€ íƒ€ì´í‹€ -->
        <TextBlock Text=" ì¼ì • ëª©ë¡" FontSize="18" Foreground="White"/>

        <!-- ì—­í•  íƒ­ (í˜„ìž¬ ì‚¬ìš©ìž ì—­í• ì— ë”°ë¼ í•˜ë‚˜ë§Œ í‘œì‹œ) -->
        <Border Background="#1A1A1A" CornerRadius="8" Padding="8">
          <Panel HorizontalAlignment="Center">
            <Border Background="#2196F3" CornerRadius="6" Padding="10,6"
                    IsVisible="{Binding ShowLocalUserTab}">
              <TextBlock Text="ì§€ìžì²´ë‹´ë‹¹ìž" Foreground="White" FontSize="12"/>
            </Border>
            <Border Background="#4CAF50" CornerRadius="6" Padding="10,6"
                    IsVisible="{Binding ShowMilitaryUserTab}">
              <TextBlock Text="ëŒ€ëŒ€ë‹´ë‹¹ìž" Foreground="White" FontSize="12"/>
            </Border>
            <Border Background="#9C27B0" CornerRadius="6" Padding="10,6"
                    IsVisible="{Binding ShowDivisionTab}">
              <TextBlock Text="ì‚¬ë‹¨ë‹´ë‹¹ìž" Foreground="White" FontSize="12"/>
            </Border>
            <Border Background="#FF9800" CornerRadius="6" Padding="10,6"
                    IsVisible="{Binding ShowRegionTab}">
              <TextBlock Text="ì§€ìžì²´(ë„)" Foreground="White" FontSize="12"/>
            </Border>
          </Panel>
        </Border>

        <!-- í˜„ìž¬ ì‚¬ìš©ìž ì •ë³´ -->
        <Border Background="#1A3A5C" CornerRadius="8" Padding="10">
          <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="5">
            <TextBlock Text="ì‚¬ìš©ìž ì •ë³´ : " FontSize="13"/>
            <TextBlock Text="{Binding CurrentUserDisplay}" Foreground="White" FontSize="13"
                       TextTrimming="CharacterEllipsis"/>
          </StackPanel>
        </Border>

        <!-- ìƒíƒœ í•„í„° íƒ­ - 2í–‰ìœ¼ë¡œ ë°°ì¹˜ -->
        <Border Background="#1A1A1A" CornerRadius="8" Padding="6">
          <StackPanel Spacing="4">
            <!-- ì²«ë²ˆì§¸ í–‰: ì „ì²´, ìƒì„±ë¨, ìž…ë ¥ë¨ -->
            <Grid ColumnDefinitions="*,*,*" HorizontalAlignment="Stretch">
              <Button Grid.Column="0" Command="{Binding SetStatusFilterCommand}" CommandParameter="all"
                      Background="{Binding SelectedStatusFilter, Converter={StaticResource StatusFilterConverter}, ConverterParameter=all}"
                      Padding="6,6" CornerRadius="6" HorizontalAlignment="Stretch" Margin="2,0">
                <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center">
                  <TextBlock Text="ì „ì²´" Foreground="White" FontSize="12"/>
                  <TextBlock Text="{Binding AllCount}" Foreground="#AAAAAA" FontSize="11"/>
                </StackPanel>
              </Button>
              <Button Grid.Column="1" Command="{Binding SetStatusFilterCommand}" CommandParameter="created"
                      Background="{Binding SelectedStatusFilter, Converter={StaticResource StatusFilterConverter}, ConverterParameter=created}"
                      Padding="6,6" CornerRadius="6" HorizontalAlignment="Stretch" Margin="2,0">
                <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center">
                  <TextBlock Text="ìƒì„±" Foreground="White" FontSize="12"/>
                  <TextBlock Text="{Binding CreatedCount}" Foreground="#AAAAAA" FontSize="11"/>
                </StackPanel>
              </Button>
              <Button Grid.Column="2" Command="{Binding SetStatusFilterCommand}" CommandParameter="inputted"
                      Background="{Binding SelectedStatusFilter, Converter={StaticResource StatusFilterConverter}, ConverterParameter=inputted}"
                      Padding="6,6" CornerRadius="6" HorizontalAlignment="Stretch" Margin="2,0">
                <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center">
                  <TextBlock Text="ìž…ë ¥" Foreground="White" FontSize="12"/>
                  <TextBlock Text="{Binding InputtedCount}" Foreground="#AAAAAA" FontSize="11"/>
                </StackPanel>
              </Button>
            </Grid>
            <!-- ë‘ë²ˆì§¸ í–‰: ì˜ˆì•½ë¨, í™•ì •ë¨ -->
            <Grid ColumnDefinitions="*,*" HorizontalAlignment="Stretch">
              <Button Grid.Column="0" Command="{Binding SetStatusFilterCommand}" CommandParameter="reserved"
                      Background="{Binding SelectedStatusFilter, Converter={StaticResource StatusFilterConverter}, ConverterParameter=reserved}"
                      Padding="6,6" CornerRadius="6" HorizontalAlignment="Stretch" Margin="2,0">
                <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center">
                  <TextBlock Text="ì˜ˆì•½" Foreground="White" FontSize="12"/>
                  <TextBlock Text="{Binding ReservedCount}" Foreground="#AAAAAA" FontSize="11"/>
                </StackPanel>
              </Button>
              <Button Grid.Column="1" Command="{Binding SetStatusFilterCommand}" CommandParameter="confirmed"
                      Background="{Binding SelectedStatusFilter, Converter={StaticResource StatusFilterConverter}, ConverterParameter=confirmed}"
                      Padding="6,6" CornerRadius="6" HorizontalAlignment="Stretch" Margin="2,0">
                <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center">
                  <TextBlock Text="í™•ì •" Foreground="White" FontSize="12"/>
                  <TextBlock Text="{Binding ConfirmedCount}" Foreground="#AAAAAA" FontSize="11"/>
                </StackPanel>
              </Button>
            </Grid>
          </StackPanel>
        </Border>

        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <Border Background="#2E7D32" CornerRadius="8" Padding="10"
                IsVisible="{Binding ShowGuideMessage}">
          <TextBlock Text="{Binding GuideMessage}" Foreground="White" FontSize="12"
                     TextWrapping="Wrap" HorizontalAlignment="Center"/>
        </Border>

        <!-- ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ -->
        <Grid ColumnDefinitions="*,Auto" IsVisible="{Binding ShowCompanyRegisterButton}">
          <TextBlock Text="ê´€í•  ì§€ì—­ ì¼ì • í™•ì¸" Foreground="#888888" FontSize="12"
                     VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
          <Button Grid.Column="1" Command="{Binding OpenCompanyRegisterCommand}"
                  Background="#FF9800" Padding="12,8" CornerRadius="6">
            <TextBlock Text="+ ì—…ì²´ë“±ë¡" Foreground="White" FontSize="13"/>
          </Button>
        </Grid>

        <Grid ColumnDefinitions="*,Auto" IsVisible="{Binding ShowScheduleCreateButton}">
          <TextBlock Text="ì¼ì • ìƒì„± ë° ê´€ë¦¬" Foreground="#888888" FontSize="12"
                     VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
          <Button Grid.Column="1" Command="{Binding OpenScheduleCreateCommand}"
                  Background="#9C27B0" Padding="12,8" CornerRadius="6">
            <TextBlock Text="+ ì¼ì •ìƒì„±" Foreground="White" FontSize="13"/>
          </Button>
        </Grid>

        <!-- ë¡œë”© í‘œì‹œ -->
        <TextBlock Text="ë¡œë”©ì¤‘..."
                   IsVisible="{Binding IsLoading}"
                   Foreground="#888888"
                   HorizontalAlignment="Center"
                   FontSize="13"/>

        <!-- ë¹ˆ ëª©ë¡ ë©”ì‹œì§€ -->
        <Border Background="#1A1A1A" CornerRadius="8" Padding="20"
                IsVisible="{Binding ShowEmptyMessage}">
          <TextBlock Text="{Binding EmptyMessage}"
                     Foreground="#888888"
                     HorizontalAlignment="Center"
                     FontSize="13"
                     TextWrapping="Wrap"/>
        </Border>

        <!-- ì¼ì • ëª©ë¡ -->
        <ItemsControl ItemsSource="{Binding Schedules}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="vm:ScheduleListItem">
              <Button Command="{Binding $parent[ItemsControl].((vm:ScheduleListViewModel)DataContext).SelectScheduleCommand}"
                      CommandParameter="{Binding}"
                      Background="Transparent"
                      Padding="0"
                      Margin="0,4"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Stretch">
                <Border Background="#1A1A1A" CornerRadius="8" Padding="12">
                  <Grid RowDefinitions="Auto,Auto,Auto,Auto">

                    <!-- Row 0: ì—…ì²´ëª… + ìƒíƒœ ë°°ì§€ -->
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                      <TextBlock Grid.Column="0" Text="{Binding CompanyName}"
                                 FontSize="14" Foreground="White" FontWeight="SemiBold"
                                 TextTrimming="CharacterEllipsis"/>
                      <Border Grid.Column="1" Background="{Binding StatusColor}"
                              CornerRadius="4" Padding="8,3" Margin="8,0,0,0">
                        <TextBlock Text="{Binding StatusDisplay}" FontSize="11" Foreground="White"/>
                      </Border>
                    </Grid>

                    <!-- Row 1: ëŒ€ëŒ€ ì •ë³´ -->
                    <TextBlock Grid.Row="1" Text="{Binding BattalionName}"
                               FontSize="12" Foreground="#AAAAAA" Margin="0,4,0,0"
                               TextTrimming="CharacterEllipsis"/>

                    <!-- Row 2: ì˜ˆì•½ ì‹œê°„ (ì˜ˆì•½ë¨/í™•ì •ë¨ ìƒíƒœì—ì„œë§Œ) -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="6" Margin="0,6,0,0"
                                IsVisible="{Binding HasReservedTime}">
                      <TextBlock Text="ðŸ“…" FontSize="12"/>
                      <TextBlock Text="{Binding ReservedTimeDisplay}"
                                 FontSize="12" Foreground="#2196F3"/>
                    </StackPanel>

                    <!-- Row 3: ì•¡ì…˜ ì˜ì—­ -->
                    <Grid Grid.Row="3" ColumnDefinitions="*,Auto" Margin="0,8,0,0">

                      <!-- í™•ì • ìƒíƒœ í‘œì‹œ (ì˜ˆì•½ë¨ ìƒíƒœ) -->
                      <StackPanel Orientation="Horizontal" Spacing="8"
                                  IsVisible="{Binding ShowConfirmStatus}">
                        <StackPanel Orientation="Horizontal" Spacing="2">
                          <TextBlock Text="ðŸ›ï¸" FontSize="11"/>
                          <TextBlock Text="{Binding LocalConfirmStatus}" FontSize="11"/>
                        </StackPanel>
                        <TextBlock Text="|" Foreground="#444444" FontSize="11"/>
                        <StackPanel Orientation="Horizontal" Spacing="2">
                          <TextBlock Text="ðŸŽ–ï¸" FontSize="11"/>
                          <TextBlock Text="{Binding MilitaryConfirmStatus}" FontSize="11"/>
                        </StackPanel>
                      </StackPanel>

                      <!-- ë¯¸í™•ì • ì •ë³´ (ì¤‘ê°„ê´€ë¦¬ìžìš©) -->
                      <TextBlock Text="{Binding UnconfirmedInfo}"
                                 FontSize="11" Foreground="#FF9800"
                                 TextTrimming="CharacterEllipsis"
                                 IsVisible="{Binding UnconfirmedInfo, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                      <!-- ì•¡ì…˜ í…ìŠ¤íŠ¸ -->
                      <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding ActionIcon}" Foreground="#2196F3" FontSize="12"/>
                        <TextBlock Text="{Binding ActionText}" Foreground="#2196F3" FontSize="12"/>
                      </StackPanel>
                    </Grid>

                    <!-- ì‚­ì œ ë²„íŠ¼ (ì‚¬ë‹¨ë‹´ë‹¹ìž, ìƒì„±ë¨ ìƒíƒœë§Œ) -->
                    <Button Grid.Row="0" Grid.RowSpan="4"
                            Command="{Binding $parent[ItemsControl].((vm:ScheduleListViewModel)DataContext).DeleteScheduleCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Padding="4"
                            Margin="0,-4,-4,0"
                            IsVisible="{Binding CanDelete}">
                      <TextBlock Text="ðŸ—‘ï¸" FontSize="14"/>
                    </Button>

                  </Grid>
                </Border>
              </Button>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

      </StackPanel>
    </ScrollViewer>
  </Grid>
</UserControl>
