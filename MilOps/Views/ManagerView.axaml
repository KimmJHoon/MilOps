<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MilOps.ViewModels"
             xmlns:models="using:MilOps.Models"
             x:Class="MilOps.Views.ManagerView"
             x:DataType="vm:ManagerViewModel">

  <Grid Background="#000000">
    <ScrollViewer>
      <StackPanel Margin="15" Spacing="15">

        <!-- í†µê³„ ë°•ìŠ¤ -->
        <Grid ColumnDefinitions="*,*,*" Margin="0,0,0,10">
          <!-- ì „ì²´ -->
          <Border Grid.Column="0" Background="#1A1A1A" CornerRadius="8" Padding="15" Margin="0,0,5,0">
            <StackPanel HorizontalAlignment="Center">
              <TextBlock Text="{Binding TotalCount}" FontSize="28" Foreground="White" HorizontalAlignment="Center"/>
              <TextBlock Text="ì „ì²´" FontSize="14" Foreground="#888888" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>

          <!-- í™œì„± (ì‚¬ìš©ë¨) -->
          <Border Grid.Column="1" Background="#1A1A1A" CornerRadius="8" Padding="15" Margin="5,0,5,0">
            <StackPanel HorizontalAlignment="Center">
              <TextBlock Text="{Binding ActiveCount}" FontSize="28" Foreground="#4CAF50" HorizontalAlignment="Center"/>
              <TextBlock Text="ì‚¬ìš©ë¨" FontSize="14" Foreground="#888888" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>

          <!-- ì´ˆëŒ€ì¤‘ (ëŒ€ê¸°) -->
          <Border Grid.Column="2" Background="#1A1A1A" CornerRadius="8" Padding="15" Margin="5,0,0,0">
            <StackPanel HorizontalAlignment="Center">
              <TextBlock Text="{Binding PendingCount}" FontSize="28" Foreground="#FF9800" HorizontalAlignment="Center"/>
              <TextBlock Text="ëŒ€ê¸°ì¤‘" FontSize="14" Foreground="#888888" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>
        </Grid>

        <!-- ëª©ë¡ í—¤ë” -->
        <Grid Margin="0,10,0,5">
          <TextBlock Text="ì´ˆëŒ€ ì½”ë“œ ëª©ë¡" FontSize="16" Foreground="White" VerticalAlignment="Center"/>
          <Button Command="{Binding OpenNewInviteDialogCommand}"
                  Background="#2196F3"
                  HorizontalAlignment="Right"
                  Padding="12,8"
                  IsVisible="{Binding TargetRole, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="+ ìƒˆ ì´ˆëŒ€" FontSize="14" Foreground="White"/>
          </Button>
        </Grid>

        <!-- ë¡œë”© í‘œì‹œ -->
        <TextBlock Text="ë¡œë”©ì¤‘..."
                   IsVisible="{Binding IsLoading}"
                   Foreground="#888888"
                   HorizontalAlignment="Center"/>

        <!-- ì´ˆëŒ€ ëª©ë¡ -->
        <ItemsControl ItemsSource="{Binding Invitations}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="models:Invitation">
              <Border Background="#1A1A1A" CornerRadius="8" Padding="15" Margin="0,5">
                <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                  <!-- ì´ˆëŒ€ì½”ë“œ + ìƒíƒœ ë°°ì§€ -->
                  <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="{Binding InviteCode}" FontSize="16" Foreground="#2196F3" FontFamily="Consolas"/>
                    <Border Background="{Binding StatusColor}" CornerRadius="4" Padding="8,2">
                      <TextBlock Text="{Binding StatusText}" FontSize="12" Foreground="White"/>
                    </Border>
                    <!-- ì½”ë“œ ë³µì‚¬ ë²„íŠ¼ (ëŒ€ê¸°ì¤‘ì¼ ë•Œë§Œ) -->
                    <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).CopyInviteCodeCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            Padding="5,0"
                            IsVisible="{Binding IsValid}">
                      <TextBlock Text="ðŸ“‹" FontSize="14"/>
                    </Button>
                  </StackPanel>

                  <!-- ì´ë¦„ + ê³„ê¸‰ + ì†Œì† + ì—­í•  -->
                  <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" Margin="0,5,0,0">
                    <TextBlock Text="{Binding Name}" FontSize="14" Foreground="White"/>
                    <TextBlock Text="{Binding MilitaryRank}" FontSize="14" Foreground="#FF9800"
                               IsVisible="{Binding MilitaryRank, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                    <TextBlock Text="{Binding DisplayAffiliation}" FontSize="14" Foreground="#888888"
                               IsVisible="{Binding DisplayAffiliation, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                    <TextBlock Text="{Binding RoleDisplayName}" FontSize="13" Foreground="#666666"/>
                  </StackPanel>

                  <!-- ì—°ë½ì²˜ -->
                  <TextBlock Grid.Row="2" Text="{Binding Phone}" FontSize="13" Foreground="#888888" Margin="0,3,0,0"
                             IsVisible="{Binding Phone, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                  <!-- ìƒì„±ì¼/ë§Œë£Œì¼ + ì•¡ì…˜ ë²„íŠ¼ -->
                  <Grid Grid.Row="3" Margin="0,5,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                      <TextBlock Text="{Binding CreatedAtText}" FontSize="12" Foreground="#888888" VerticalAlignment="Center"/>
                      <TextBlock Text="{Binding ExpiresAtText}" FontSize="12" Foreground="#888888" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- ì‚¬ìš©ë¨: ì‚­ì œ ë²„íŠ¼ -->
                    <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).DeleteInvitationCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            HorizontalAlignment="Right"
                            IsVisible="{Binding IsUsed}">
                      <TextBlock Text="ì‚­ì œ" FontSize="14" Foreground="#F44336"/>
                    </Button>

                    <!-- ëŒ€ê¸°ì¤‘: ìž¬ë°œì†¡/ì·¨ì†Œ ë²„íŠ¼ -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="15"
                                IsVisible="{Binding IsValid}">
                      <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).ResendInvitationCommand}"
                              CommandParameter="{Binding}"
                              Background="Transparent">
                        <TextBlock Text="ì—°ìž¥" FontSize="14" Foreground="#4CAF50"/>
                      </Button>
                      <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).CancelInvitationCommand}"
                              CommandParameter="{Binding}"
                              Background="Transparent">
                        <TextBlock Text="ì·¨ì†Œ" FontSize="14" Foreground="#888888"/>
                      </Button>
                    </StackPanel>

                    <!-- ë§Œë£Œë¨: ìž¬ë°œì†¡ ë²„íŠ¼ -->
                    <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).ResendInvitationCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            HorizontalAlignment="Right"
                            IsVisible="{Binding IsExpired}">
                      <TextBlock Text="ì—°ìž¥" FontSize="14" Foreground="#4CAF50"/>
                    </Button>
                  </Grid>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

      </StackPanel>
    </ScrollViewer>

    <!-- ìƒˆ ì´ˆëŒ€ ë‹¤ì´ì–¼ë¡œê·¸ ì˜¤ë²„ë ˆì´ -->
    <Border Background="#80000000" IsVisible="{Binding IsNewInviteDialogOpen}"/>

    <!-- ìƒˆ ì´ˆëŒ€ ë‹¤ì´ì–¼ë¡œê·¸ -->
    <Border Background="#222222"
            CornerRadius="10"
            Padding="20"
            Width="320"
            VerticalAlignment="Center"
            HorizontalAlignment="Center"
            IsVisible="{Binding IsNewInviteDialogOpen}">
      <StackPanel Spacing="15">
        <!-- ë™ì  íƒ€ì´í‹€ -->
        <TextBlock Text="{Binding InviteFormTitle}" FontSize="18" Foreground="White" HorizontalAlignment="Center"/>

        <!-- ì†Œì† (ComboBox - ê¸°ë³¸ ëª¨ë“œ) -->
        <StackPanel Spacing="5" IsVisible="{Binding ShowAffiliationComboBox}">
          <TextBlock Text="{Binding AffiliationLabel}" Foreground="#AAAAAA" FontSize="13"/>
          <ComboBox ItemsSource="{Binding AffiliationOptions}"
                    SelectedItem="{Binding SelectedAffiliation}"
                    Background="#333333"
                    Foreground="White"
                    HorizontalAlignment="Stretch"/>
        </StackPanel>

        <!-- ì†Œì† (í…ìŠ¤íŠ¸ ìž…ë ¥ - ëŒ€ëŒ€ë‹´ë‹¹ìž ì´ˆëŒ€ ëª¨ë“œ) -->
        <StackPanel Spacing="5" IsVisible="{Binding ShowBattalionTextInput}">
          <TextBlock Text="{Binding AffiliationLabel}" Foreground="#AAAAAA" FontSize="13"/>
          <Grid ColumnDefinitions="*,Auto">
            <TextBox Grid.Column="0"
                     Text="{Binding NewBattalionName}"
                     Watermark="ì˜ˆ: 101"
                     Background="#333333"
                     Foreground="White"
                     Padding="10"/>
            <TextBlock Grid.Column="1"
                       Text=" ëŒ€ëŒ€"
                       Foreground="White"
                       FontSize="14"
                       VerticalAlignment="Center"
                       Margin="8,0,0,0"/>
          </Grid>
        </StackPanel>

        <!-- ì´ë¦„ -->
        <StackPanel Spacing="5">
          <TextBlock Text="ì´ë¦„" Foreground="#AAAAAA" FontSize="13"/>
          <TextBox Text="{Binding NewInviteName}"
                   Watermark="ì´ë¦„ ìž…ë ¥"
                   Background="#333333"
                   Foreground="White"
                   Padding="10"/>
        </StackPanel>

        <!-- ì—°ë½ì²˜ -->
        <StackPanel Spacing="5">
          <TextBlock Text="ì—°ë½ì²˜" Foreground="#AAAAAA" FontSize="13"/>
          <TextBox Text="{Binding NewInvitePhone}"
                   Watermark="010-0000-0000"
                   Background="#333333"
                   Foreground="White"
                   Padding="10"/>
        </StackPanel>

        <!-- ê³„ê¸‰ (êµ°ë¶€ëŒ€ìš©ë§Œ í‘œì‹œ) -->
        <StackPanel Spacing="5" IsVisible="{Binding ShowRankField}">
          <TextBlock Text="ê³„ê¸‰" Foreground="#AAAAAA" FontSize="13"/>
          <ComboBox ItemsSource="{Binding RankOptions}"
                    SelectedItem="{Binding SelectedRankOption}"
                    Background="#333333"
                    Foreground="White"
                    HorizontalAlignment="Stretch"/>
        </StackPanel>

        <!-- ë³µì‚¬ ì™„ë£Œ ë©”ì‹œì§€ -->
        <TextBlock Text="{Binding CopiedMessage}"
                   Foreground="#4CAF50"
                   FontSize="13"
                   HorizontalAlignment="Center"
                   IsVisible="{Binding CopiedMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

        <!-- ë²„íŠ¼ë“¤ -->
        <Grid ColumnDefinitions="*,*" Margin="0,5,0,0">
          <Button Grid.Column="0" Command="{Binding CloseNewInviteDialogCommand}"
                  Background="#555555" Margin="0,0,5,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Padding="12">
            <TextBlock Text="ë‹«ê¸°" Foreground="White"/>
          </Button>
          <Button Grid.Column="1" Command="{Binding SendInviteCommand}"
                  Background="#2196F3" Margin="5,0,0,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Padding="12">
            <TextBlock Text="ì´ˆëŒ€ ë°œì†¡" Foreground="White"/>
          </Button>
        </Grid>
      </StackPanel>
    </Border>
  </Grid>
</UserControl>
