<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MilOps.ViewModels"
             xmlns:models="using:MilOps.Models"
             x:Class="MilOps.Views.ManagerView"
             x:DataType="vm:ManagerViewModel">

  <Grid Background="#000000">
    <ScrollViewer HorizontalScrollBarVisibility="Disabled">
      <StackPanel Margin="10" Spacing="10">

        <!-- í†µê³„ ë°•ìŠ¤ -->
        <Grid ColumnDefinitions="*,*,*" Margin="0,0,0,5">
          <!-- ì „ì²´ -->
          <Border Grid.Column="0" Background="#1A1A1A" CornerRadius="8" Padding="10" Margin="0,0,3,0">
            <StackPanel HorizontalAlignment="Center">
              <TextBlock Text="{Binding TotalCount}" FontSize="24" Foreground="White" HorizontalAlignment="Center"/>
              <TextBlock Text="ì „ì²´" FontSize="12" Foreground="#888888" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>

          <!-- í™œì„± (í™œì„±í™”) -->
          <Border Grid.Column="1" Background="#1A1A1A" CornerRadius="8" Padding="10" Margin="3,0">
            <StackPanel HorizontalAlignment="Center">
              <TextBlock Text="{Binding ActiveCount}" FontSize="24" Foreground="#4CAF50" HorizontalAlignment="Center"/>
              <TextBlock Text="í™œì„±í™”" FontSize="12" Foreground="#888888" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>

          <!-- ì´ˆëŒ€ì¤‘ (ëŒ€ê¸°) -->
          <Border Grid.Column="2" Background="#1A1A1A" CornerRadius="8" Padding="10" Margin="3,0,0,0">
            <StackPanel HorizontalAlignment="Center">
              <TextBlock Text="{Binding PendingCount}" FontSize="24" Foreground="#FF9800" HorizontalAlignment="Center"/>
              <TextBlock Text="ëŒ€ê¸°ì¤‘" FontSize="12" Foreground="#888888" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>
        </Grid>

        <!-- ëª©ë¡ í—¤ë” -->
        <Grid Margin="0,5,0,5">
          <TextBlock Text="ì´ˆëŒ€ ì½”ë“œ ëª©ë¡" FontSize="14" Foreground="White" VerticalAlignment="Center"/>
          <Button Command="{Binding OpenNewInviteDialogCommand}"
                  Background="#2196F3"
                  HorizontalAlignment="Right"
                  Padding="10,6"
                  CornerRadius="6"
                  IsVisible="{Binding TargetRole, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="+ ìƒˆ ì´ˆëŒ€" FontSize="13" Foreground="White"/>
          </Button>
        </Grid>

        <!-- ë¡œë”© í‘œì‹œ -->
        <TextBlock Text="ë¡œë”©ì¤‘..."
                   IsVisible="{Binding IsLoading}"
                   Foreground="#888888"
                   HorizontalAlignment="Center"/>

        <!-- ì´ˆëŒ€ ëª©ë¡ -->
        <ItemsControl ItemsSource="{Binding Invitations}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="models:Invitation">
              <Border Background="#1A1A1A" CornerRadius="8" Padding="12" Margin="0,4">
                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto">
                  <!-- Row 0: ì´ˆëŒ€ì½”ë“œ + ìƒíƒœ ë°°ì§€ -->
                  <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto">
                    <TextBlock Grid.Column="0" Text="{Binding InviteCode}" FontSize="14" Foreground="#2196F3"
                               FontFamily="Consolas" TextTrimming="CharacterEllipsis"/>
                    <Border Grid.Column="1" Background="{Binding StatusColor}" CornerRadius="4" Padding="6,2" Margin="6,0,0,0">
                      <TextBlock Text="{Binding StatusText}" FontSize="11" Foreground="White"/>
                    </Border>
                    <!-- ì½”ë“œ ë³µì‚¬ ë²„íŠ¼ (ëŒ€ê¸°ì¤‘ì¼ ë•Œë§Œ) -->
                    <Button Grid.Column="2"
                            Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).CopyInviteCodeCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            Padding="4,0"
                            Margin="4,0,0,0"
                            IsVisible="{Binding IsValid}">
                      <TextBlock Text="ðŸ“‹" FontSize="12"/>
                    </Button>
                  </Grid>

                  <!-- Row 1: ì´ë¦„ + ê³„ê¸‰ -->
                  <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                    <TextBlock Text="{Binding Name}" FontSize="13" Foreground="White"/>
                    <TextBlock Text="{Binding MilitaryRank}" FontSize="13" Foreground="#FF9800"
                               IsVisible="{Binding MilitaryRank, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                  </StackPanel>

                  <!-- Row 2: ì†Œì† + ì—­í•  -->
                  <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="6" Margin="0,2,0,0">
                    <TextBlock Text="{Binding DisplayAffiliation}" FontSize="12" Foreground="#888888"
                               TextTrimming="CharacterEllipsis"
                               IsVisible="{Binding DisplayAffiliation, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                    <TextBlock Text="{Binding RoleDisplayName}" FontSize="11" Foreground="#666666"/>
                  </StackPanel>

                  <!-- Row 3: ì—°ë½ì²˜ -->
                  <TextBlock Grid.Row="3" Text="{Binding Phone}" FontSize="12" Foreground="#888888" Margin="0,2,0,0"
                             IsVisible="{Binding Phone, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                  <!-- Row 4: ìƒì„±ì¼/ë§Œë£Œì¼ + ì•¡ì…˜ ë²„íŠ¼ -->
                  <Grid Grid.Row="4" ColumnDefinitions="*,Auto" Margin="0,6,0,0">
                    <StackPanel Grid.Column="0" Spacing="2">
                      <TextBlock Text="{Binding CreatedAtText}" FontSize="11" Foreground="#888888"/>
                      <TextBlock Text="{Binding ExpiresAtText}" FontSize="11" Foreground="#888888"/>
                    </StackPanel>

                    <!-- í™œì„±í™”: ì‚­ì œ ë²„íŠ¼ -->
                    <Button Grid.Column="1"
                            Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).DeleteInvitationCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            IsVisible="{Binding IsUsed}">
                      <TextBlock Text="ì‚­ì œ" FontSize="13" Foreground="#F44336"/>
                    </Button>

                    <!-- ëŒ€ê¸°ì¤‘: ìž¬ë°œì†¡/ì·¨ì†Œ ë²„íŠ¼ -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12"
                                IsVisible="{Binding IsValid}">
                      <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).ResendInvitationCommand}"
                              CommandParameter="{Binding}"
                              Background="Transparent">
                        <TextBlock Text="ì—°ìž¥" FontSize="13" Foreground="#4CAF50"/>
                      </Button>
                      <Button Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).CancelInvitationCommand}"
                              CommandParameter="{Binding}"
                              Background="Transparent">
                        <TextBlock Text="ì·¨ì†Œ" FontSize="13" Foreground="#888888"/>
                      </Button>
                    </StackPanel>

                    <!-- ë§Œë£Œë¨: ìž¬ë°œì†¡ ë²„íŠ¼ -->
                    <Button Grid.Column="1"
                            Command="{Binding $parent[ItemsControl].((vm:ManagerViewModel)DataContext).ResendInvitationCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            IsVisible="{Binding IsExpired}">
                      <TextBlock Text="ì—°ìž¥" FontSize="13" Foreground="#4CAF50"/>
                    </Button>
                  </Grid>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

      </StackPanel>
    </ScrollViewer>

    <!-- ìƒˆ ì´ˆëŒ€ ë‹¤ì´ì–¼ë¡œê·¸ ì˜¤ë²„ë ˆì´ -->
    <Border Background="#80000000" IsVisible="{Binding IsNewInviteDialogOpen}"/>

    <!-- ìƒˆ ì´ˆëŒ€ ë‹¤ì´ì–¼ë¡œê·¸ - ë°˜ì‘í˜• (ì¢Œìš° ì—¬ë°± ìœ ì§€) -->
    <Border Background="#222222"
            CornerRadius="10"
            Padding="16"
            Margin="20,40"
            MaxWidth="350"
            VerticalAlignment="Center"
            HorizontalAlignment="Stretch"
            IsVisible="{Binding IsNewInviteDialogOpen}">
      <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="12">
          <!-- ë™ì  íƒ€ì´í‹€ -->
          <TextBlock Text="{Binding InviteFormTitle}" FontSize="16" Foreground="White" HorizontalAlignment="Center"/>

          <!-- ì†Œì† (ComboBox - ê¸°ë³¸ ëª¨ë“œ) -->
          <StackPanel Spacing="4" IsVisible="{Binding ShowAffiliationComboBox}">
            <TextBlock Text="{Binding AffiliationLabel}" Foreground="#AAAAAA" FontSize="12"/>
            <ComboBox ItemsSource="{Binding AffiliationOptions}"
                      SelectedItem="{Binding SelectedAffiliation}"
                      Background="#333333"
                      Foreground="White"
                      HorizontalAlignment="Stretch"/>
          </StackPanel>

          <!-- ì†Œì† (í…ìŠ¤íŠ¸ ìž…ë ¥ - ì‚¬ë‹¨/ëŒ€ëŒ€ ì§ì ‘ ìž…ë ¥ ëª¨ë“œ) -->
          <StackPanel Spacing="4" IsVisible="{Binding ShowAffiliationTextInput}">
            <TextBlock Text="{Binding AffiliationLabel}" Foreground="#AAAAAA" FontSize="12"/>
            <Grid ColumnDefinitions="*,Auto">
              <TextBox Grid.Column="0"
                       Text="{Binding NewAffiliationText}"
                       Watermark="ì˜ˆ: 31"
                       Background="#333333"
                       Foreground="White"
                       Padding="8"
                       MaxLength="5"/>
              <TextBlock Grid.Column="1"
                         Text="{Binding AffiliationSuffix}"
                         Foreground="White"
                         FontSize="13"
                         VerticalAlignment="Center"
                         Margin="6,0,0,0"/>
            </Grid>
            <TextBlock Text="* ìµœëŒ€ 5ìžë¦¬ ìˆ«ìžê¹Œì§€ ìž…ë ¥ ê°€ëŠ¥" Foreground="#666666" FontSize="10"/>
          </StackPanel>

          <!-- ì´ë¦„ -->
          <StackPanel Spacing="4">
            <TextBlock Text="ì´ë¦„" Foreground="#AAAAAA" FontSize="12"/>
            <TextBox Text="{Binding NewInviteName}"
                     Watermark="ì´ë¦„ ìž…ë ¥"
                     Background="#333333"
                     Foreground="White"
                     Padding="8"/>
          </StackPanel>

          <!-- ì—°ë½ì²˜ -->
          <StackPanel Spacing="4">
            <TextBlock Text="ì—°ë½ì²˜" Foreground="#AAAAAA" FontSize="12"/>
            <TextBox Text="{Binding NewInvitePhone}"
                     Watermark="010-0000-0000"
                     Background="#333333"
                     Foreground="White"
                     Padding="8"/>
          </StackPanel>

          <!-- ê³„ê¸‰ (êµ°ë¶€ëŒ€ìš©ë§Œ í‘œì‹œ) -->
          <StackPanel Spacing="4" IsVisible="{Binding ShowRankField}">
            <TextBlock Text="ê³„ê¸‰" Foreground="#AAAAAA" FontSize="12"/>
            <ComboBox ItemsSource="{Binding RankOptions}"
                      SelectedItem="{Binding SelectedRankOption}"
                      Background="#333333"
                      Foreground="White"
                      HorizontalAlignment="Stretch"/>
          </StackPanel>

          <!-- ë³µì‚¬ ì™„ë£Œ ë©”ì‹œì§€ -->
          <TextBlock Text="{Binding CopiedMessage}"
                     Foreground="#4CAF50"
                     FontSize="12"
                     HorizontalAlignment="Center"
                     IsVisible="{Binding CopiedMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

          <!-- ë²„íŠ¼ë“¤ -->
          <Grid ColumnDefinitions="*,*" Margin="0,4,0,0">
            <Button Grid.Column="0" Command="{Binding CloseNewInviteDialogCommand}"
                    Background="#555555" Margin="0,0,4,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Padding="10" CornerRadius="6">
              <TextBlock Text="ë‹«ê¸°" Foreground="White" FontSize="13"/>
            </Button>
            <Button Grid.Column="1" Command="{Binding SendInviteCommand}"
                    Background="#2196F3" Margin="4,0,0,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Padding="10" CornerRadius="6">
              <TextBlock Text="ì´ˆëŒ€ ë°œì†¡" Foreground="White" FontSize="13"/>
            </Button>
          </Grid>
        </StackPanel>
      </ScrollViewer>
    </Border>
  </Grid>
</UserControl>
